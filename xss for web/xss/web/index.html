<!DOCTYPE html>
<html lang="en" xmlns:v-bind="http://www.w3.org/1999/xhtml" xmlns:v-on="http://www.w3.org/1999/xhtml">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <script src="js/vue.min.js"></script>
    <script src="js/jquery-3.2.1.min.js"></script>
    <script src="js/bootstrap.min.js"></script>
    <script src="js/layer.js"></script>
    <link href="css/paper.css" rel="stylesheet"/>
    <link href="css/bootstrap.min.css" rel="stylesheet">
    <link href="css/layer.css" rel="stylesheet">

</head>
<body>
<div id="jmp_head"></div>
<div class="row">
    <div class="col-md-8 col-md-offset-2 col-xs-10 col-xs-offset-1
            col-lg-8 col-lg-offset-2 col-sm-10 col-sm-offset-1">
        <h2 id="title">{{title}}</h2>
    </div>
</div>

</div>
<div class="row">
    <div id="xsContent" class="col-md-8 col-md-offset-2 col-xs-10 col-xs-offset-1
            col-lg-8 col-lg-offset-2 col-sm-10 col-sm-offset-1">
        <template v-for="c in xsContent">
            <p>{{c}}</p>
        </template>
    </div>
</div>

<div class="row">
    <div class="nav_float">
        <div class="col-xl-3 col-sm-3 col-md-3 col-lg-3" id="openPage">
            <button class="btn btn-default" v-on:click="openPage()">
                {{msg}}
            </button>
        </div>

    </div>
</div>

<div class="row">
    <div id="prev" class="col-lg-6 col-md-6 col-sm-6 col-xs-6">
        <button class="btn btn-default center-block" v-on:click="getPrevPage()">上一页</button>
    </div>
    <div id="next" class="col-lg-6 col-md-6 col-sm-6 col-xs-6"">
        <button class="btn btn-primary center-block" v-on:click="getNextPage()">下一页</button>
    </div>
</div>

<br />
</body>
<script>
    var requestUrl = 'http://192.168.1.9:8081/getXsChapter';

    var content = new Vue({
        el: '#xsContent',
        data: {
            xsContent: []
        }
    });

    var prev = new Vue({
        el: '#prev',
        data: {
            prevUrl: ''
        },
        methods: {
            getPrevPage: function () {
                loadPage(this.prevUrl);
            }
        }
    });

    var next = new Vue({
        el: '#next',
        data: {
            nextUrl: ''
        },
        methods: {
            getNextPage: function () {
                loadPage(this.nextUrl);
            }
        }
    })

    var title = new Vue({
        el: '#title',
        data: {
            title: ''
        }
    });

    var openPage = new Vue({
        el: '#openPage',
        data: {
            msg: '加载小说'
        },
        methods: {
            openPage: function () {
                open();
            }
        }
    });

    var loadPage = function (webpath) {
        var url = "url=" + webpath;
        $.ajax({
            url: requestUrl, data: url,
            headers: {
                'Accept': 'application/json;charset=UTF-8',
                'Access-Control-Allow-Origin': '*'
            },
            success: function (result) {
                if (result.code != '0') {
                    layer.msg(result.msg);
                    return;
                }

                content.$set(content.$data, "xsContent", result.data.content.split('\n'));
                content.$set(content.$data, "loadStatus", 'true');
                prev.$set(prev.$data, "prevUrl", result.data.prevUrl);
                next.$set(next.$data, "nextUrl", result.data.nextUrl);
                title.$set(title.$data, "title", result.data.title);
                location.href = "#jmp_head";
            }
        });
    }

    function open() {
        layer.prompt({title: '请输入小说章节地址', formType: 3}, function (webpath, index) {
            loadPage(webpath);
            layer.close(index);
        });
    }

    open();
</script>
</html>